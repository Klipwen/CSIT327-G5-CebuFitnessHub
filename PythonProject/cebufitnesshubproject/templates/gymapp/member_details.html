{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Details - Cebu Fitness Hub</title>
  <link rel="icon" href="{% static 'gymapp/img/cebufitnesshub_logo.svg' %}" type="image/svg+xml">
  <link rel="stylesheet" href="{% static 'gymapp/css/dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'gymapp/css/member_details.css' %}">
</head>
<body data-use-logout-modal="true">  
  <header class="site-header">
    <div class="brand">
      <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="Cebu Fitness Hub" class="logo">
      <div class="logo-text">
        <div class="cebu-reg">CEBU</div>
        <div class="fitness-hub-reg">FITNESS HUB</div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <span class="user-icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#6BCB3D"><path d="M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113Z"/></svg>
        </span>
        <span class="user-name">{{ user.get_full_name|default:"Member" }}</span>
      </div>
      <nav class="navbar">
        <ul>
          <li><a href="{% url 'member_dashboard' %}">Homepage</a></li>
          <li><a href="{% url 'member_schedule' %}">Schedule</a></li>
          <li><a href="#">Occupancy</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="sidebar-bg-fix"></div>
  <div class="layout">
    <aside class="sidebar">
      <h3 class="sidebar-title">DASHBOARD</h3>
      <nav class="side-nav">
        <a href="{% url 'member_dashboard' %}" class="nav-item">Home / Overview</a>
        <a href="{% url 'member_details' %}" class="nav-item active">My Details</a>
        <a href="{% url 'check_in' %}" class="nav-item">Check-in History</a>
        <a href="{% url 'billing_history' %}" class="nav-item">Billing History</a>
        <a href="{% url 'member_schedule' %}" class="nav-item">Schedule</a>
        <a href="{% url 'account_settings' %}" class="nav-item">Account Settings</a>
        <a href="#" class="nav-item" id="logoutBtn" data-logout-url="{% url 'logout' %}">Logout</a> 
      </nav>
    </aside>

    <main class="main">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      <div class="main-content">
        <div class="details-container">
          <!-- Profile header section -->
          <div class="profile-header">
            <div class="profile-info">
              <div class="profile-avatar"></div>
              <div class="profile-text">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <h2>{{ user.first_name }} {{ user.last_name }}</h2>
                  <span class="status-badge">{{ user.is_active|yesno:"Active,Inactive" }}</span>
                </div>
                <p>{{ email }}</p>
              </div>
            </div>
            <div class="profile-actions">
              <button id="editBtn" class="edit-btn">Edit</button>
              <button id="cancelBtn" class="edit-btn hidden" style="background-color: #dc3545;">Cancel</button> {# Added inline style for cancel button color #}
              <button id="saveBtn" form="detailsForm" class="edit-btn hidden">Save</button>
            </div>
          </div>

          <form id="detailsForm" method="post" action="{% url 'member_details' %}">
            {% csrf_token %}
            <!-- Member Information Section -->
            <div class="section-title">Member Information</div>
            <div class="member-form">
              
              <div>
                <label>Date Joined</label>
                <input type="text" value="{{ date_joined|date:'F d, Y' }}" readonly>
              </div>
              <div>
                <label>Contact Number</label>
                <input type="text" class="details-field" name="contact_number" value="{{ contact_number }}" readonly>
              </div>
            </div>

            <!-- Emergency Contact Section -->
            <div class="section-title">Emergency Contact</div>
            <div class="member-form">
              <div>
                <label>Emergency Contact Name</label>
                <input type="text" class="details-field" name="emergency_contact_name" value="{{ emergency_contact_name }}" readonly>
              </div>
              <div>
                <label>Emergency Contact Number</label>
                <input type="text" class="details-field" name="emergency_contact_number" value="{{ emergency_contact_number }}" readonly>
              </div>
            </div>

            <!-- Fitness Goals Section -->
            <div class="section-title">Fitness Goals</div>
            <div class="member-form full">
              <div>
                <textarea class="details-field" rows="5" name="fitness_goals" placeholder="I want to become ..." readonly>{{ fitness_goals }}</textarea>
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title">Success</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Details updated successfully!
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <div id="modalLogout" class="modal" aria-hidden="true">
    <div class="modal-content modal-content--enhanced modal-content--small">
      <button class="modal-close-icon" data-close>&times;</button>
      <div class="modal-brand-header">
        <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="Cebu Fitness Hub Logo" class="modal-brand-header__logo">
        <div class="modal-brand-header__text">
          <div class="modal-brand-header__line-1">CEBU</div>
          <div class="modal-brand-header__line-2">FITNESS HUB</div>
        </div>
      </div>
      <h3 class="modal-title--enhanced">
        Ready to <span class="modal-title-highlight">Logout?</span>
      </h3>
      <p class="modal-instruction">
        Confirm to securely end this member session.
      </p>
      <div class="modal-action-buttons">
        <button type="button"
                class="modal-action-btn modal-btn-approve"
                id="btnConfirmLogout"
                data-logout-url="{% url 'logout' %}">
          Yes, Logout
        </button>
        <button type="button"
                class="modal-action-btn modal-btn-reject"
                data-close>
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'gymapp/js/dashboard.js' %}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const editBtn = document.getElementById('editBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const saveBtn = document.getElementById('saveBtn');
      const fields = Array.from(document.querySelectorAll('.details-field'));

      const originalValues = new Map();

      // Hide Save and Cancel on load
      cancelBtn.classList.add('hidden');
      saveBtn.classList.add('hidden');

      function enableEdit() {
        originalValues.clear();
        fields.forEach(f => {
          originalValues.set(f.name, f.value);
          f.removeAttribute('readonly');
        });

        editBtn.classList.add('hidden');
        cancelBtn.classList.remove('hidden');
        saveBtn.classList.remove('hidden');
      }

      function cancelEdit(e) {
        e.preventDefault();
        fields.forEach(f => {
          if (originalValues.has(f.name)) {
            f.value = originalValues.get(f.name);
          }
          f.setAttribute('readonly', true);
        });

        editBtn.classList.remove('hidden');
        cancelBtn.classList.add('hidden');
        saveBtn.classList.add('hidden');
      }

      // Event listeners
      editBtn.addEventListener('click', enableEdit);
      cancelBtn.addEventListener('click', cancelEdit);
    });
  </script>

</body>
</html>