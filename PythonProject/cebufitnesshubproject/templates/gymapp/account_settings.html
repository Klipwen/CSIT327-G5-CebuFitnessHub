{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account Settings</title>
    <link rel="stylesheet" href="{% static 'gymapp/css/account_settings.css' %}">
</head>
<body>
    <!-- Header/Nav bar (same layout as dashboard) -->
    <header class="site-header">
    <div class="brand">
      <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="Cebu Fitness Hub" class="logo">
      <div class="logo-text">
            <div class="cebu-reg">CEBU</div>
            <div class="fitness-hub-reg">FITNESS HUB</div>
      </div>
    </div>
    <div class="header-right">
      <div class="user-info">
        <span class="user-icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#6BCB3D"><path d="M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113ZM120-240h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0 320Zm0-400Z"/></svg>
        </span>
        <span class="user-name">{{ member_name|default:"Naruto Uzumaki" }}</span>
    </div>
    <nav class="navbar">
      <ul>
          <li><a href="#home">Homepage</a></li>
          <li><a href="#schedule">Schedule</a></li>
          <li><a href="#occupancy">Occupancy</a></li>
      </ul>
    </nav>
    </div>
  </header>

    <div class="container">
        <!-- Sidebar (same as dashboard) -->
        <div class="sidebar">
            <div class="side-title">DASHBOARD</div>
            <a href="{% url 'member_dashboard' %}" class="side-nav">Home/Overview</a>
            <a href="#" class="side-nav">My Details</a>
            <a href="#" class="side-nav">Check-in History</a>
            <a href="#" class="side-nav">Billing History</a>
            <a href="{% url 'account_settings' %}" class="side-nav active">Account Settings</a>
        </div>

        <!-- Main content: Settings -->
        <div class="main-content">
            <div class="settings-box">
                <div class="settings-header">
                    <h1 class="settings-title">SETTINGS</h1>
                </div>

                <div class="settings-section">
                    <h2 class="settings-subtitle">Security Management</h2>
                    <button id="btnOpenChangePassword" class="btn btn-green">Change Password</button>
                </div>

                <div class="settings-section">
                    <h2 class="settings-subtitle">Membership Management</h2>
                    {% if not request.user.is_frozen %}
                        {% if request.user.freeze_request_status == 'pending' %}
                            <button class="btn btn-pending" disabled>Request Pending</button>
                        {% else %}
                            <button id="btnOpenFreeze" class="btn btn-danger">Request Account Freeze</button>
                        {% endif %}
                    {% else %}
                        {% if request.user.unfreeze_request_status == 'pending' %}
                            <button class="btn btn-pending" disabled>Request Pending</button>
                        {% else %}
                            <button id="btnOpenUnfreeze" class="btn btn-green">Request Account Unfreeze</button>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="modalChangePassword" class="modal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="logo" class="modal-logo" />
                <span class="modal-close" data-close>&times;</span>
                <h3>Change <span style="color:#6cc04a">Password</span></h3>
            </div>
            <form method="post" action="{% url 'change_password' %}" class="modal-form">
                {% csrf_token %}
                <label>Current Password <span class="required-asterisk">*</span></label>
                <input type="password" name="current_password" placeholder="Enter your current password" required />

                <label>New Password <span class="required-asterisk">*</span></label>
                <input type="password" name="new_password" placeholder="Enter a new password" required />

                <label>Confirm New Password <span class="required-asterisk">*</span></label>
                <input type="password" name="confirm_password" placeholder="Confirm your new password" required />

                <div class="modal-actions">
                    <button type="submit" class="btn btn-green">Change Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Request Freeze Modal -->
    <div id="modalFreeze" class="modal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="logo" class="modal-logo" />
                <span class="modal-close" data-close>&times;</span>
                <h3>Request Account <span style="color:#6cc04a">Freeze</span></h3>
            </div>
            <form method="post" action="{% url 'request_account_freeze' %}" class="modal-form">
                {% csrf_token %}
                <label>Reason <span class="required-asterisk">*</span></label>
                <textarea name="reason" placeholder="Please provide a brief reason for your request..." required></textarea>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-green">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Request Unfreeze Modal -->
    <div id="modalUnfreeze" class="modal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <img src="{% static 'gymapp/img/cebufitnesshub_logo.png' %}" alt="logo" class="modal-logo" />
                <span class="modal-close" data-close>&times;</span>
                <h3>Request Account <span style="color:#6cc04a">Unfreeze</span></h3>
            </div>
            <form method="post" action="{% url 'request_account_unfreeze' %}" class="modal-form">
                {% csrf_token %}
                <label>Reason <span class="required-asterisk">*</span></label>
                <textarea name="reason" placeholder="Please provide a brief reason for your request..." required></textarea>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-green">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const modalChange = document.getElementById('modalChangePassword');
        const modalFreeze = document.getElementById('modalFreeze');
        const modalUnfreeze = document.getElementById('modalUnfreeze');
        const openChangeBtn = document.getElementById('btnOpenChangePassword');
        const openFreezeBtn = document.getElementById('btnOpenFreeze');
        const openUnfreezeBtn = document.getElementById('btnOpenUnfreeze');

        function openModal(m) { m.classList.add('show'); m.setAttribute('aria-hidden','false'); }
        function closeModal(m) { m.classList.remove('show'); m.setAttribute('aria-hidden','true'); }

        if (openChangeBtn) openChangeBtn.addEventListener('click', () => openModal(modalChange));
        if (openFreezeBtn) openFreezeBtn.addEventListener('click', () => openModal(modalFreeze));
        if (openUnfreezeBtn) openUnfreezeBtn.addEventListener('click', () => openModal(modalUnfreeze));

        document.querySelectorAll('[data-close]').forEach(el => {
            el.addEventListener('click', (e) => {
                const parent = e.target.closest('.modal');
                closeModal(parent);
            });
        });
        document.querySelectorAll('.modal').forEach(m => {
            m.addEventListener('click', (e) => { if (e.target === m) closeModal(m); });
        });
    </script>
</body>
</html>